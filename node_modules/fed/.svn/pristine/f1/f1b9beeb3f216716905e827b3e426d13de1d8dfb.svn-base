var express, lessMiddleware, os, path;

lessMiddleware = require("less-middleware");

express = require("express");

os = require("os");

path = require("path");

exports.init = function(lessCfg) {
  return Hub.on("localServer.loadRoute.before", function(param) {
    var app;
    app = param.app;
    lessCfg.src = app.get("static resource");
    if (lessCfg.useTmpDir) {
      lessCfg.dest = path.join(os.tmpDir(), "tmp_fed_less");
    } else if (!lessCfg.dest) {
      lessCfg.dest = lessCfg.src;
    }
    app.use(lessMiddleware(lessCfg));
    if (lessCfg.useTmpDir) {
      return app.use(express["static"](lessCfg.dest));
    }
  });
};
