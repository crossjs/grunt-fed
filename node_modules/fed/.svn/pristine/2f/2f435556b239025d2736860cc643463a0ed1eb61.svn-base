var coffeeMiddleware, express, os, path;

coffeeMiddleware = require("coffee-middleware");

express = require("express");

os = require("os");

path = require("path");

exports.init = function(config) {
  var coffeeCfg;
  coffeeCfg = {
    force: config.force,
    once: config.once,
    debug: config.debug,
    src: "",
    dest: "",
    prefix: config.prefix || "",
    useTmpDir: config.useTmpDir
  };
  return this.on("appinit2", function(app) {
    coffeeCfg.src = app.get("static resource");
    coffeeCfg.dest = !coffeeCfg.useTmpDir ? coffeeCfg.src : path.join(os.tmpDir(), "tmp_fed_coffee");
    app.use(coffeeMiddleware(coffeeCfg));
    if (coffeeCfg.useTmpDir) {
      return app.use(express["static"](coffeeCfg.dest));
    }
  });
};
